<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystical Tao</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            background: transparent;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas id="c"></canvas>
    <script>
        var canvas = document.getElementById("c");
        var ctx = canvas.getContext("2d");

        var PARTICLES = 80, SPEED = 0.01, DIR = 1, CLOCK = false, LOWCPU = false;
        var cx, cy, r, rot = 0, t = 0;
        var pts = [];
        var running = false, rafId = null;

        function resize() {
            canvas.width = innerWidth;
            canvas.height = innerHeight;
            cx = canvas.width / 2;
            cy = canvas.height / 2;
            r = Math.min(canvas.width, canvas.height) / 4;
        }
        resize();

        function mkPart() {
            var a = Math.random() * 6.283;
            var d = r + Math.random() * 80;
            return {
                x: cx + Math.cos(a) * d, y: cy + Math.sin(a) * d,
                vx: (Math.random() - 0.5) * 0.4, vy: (Math.random() - 0.5) * 0.4,
                life: 1, decay: 0.002 + Math.random() * 0.003,
                sz: Math.random() * 1.5 + 0.5
            };
        }

        function initParts() {
            pts = [];
            for (var i = 0; i < PARTICLES; i++) pts.push(mkPart());
        }
        initParts();

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Particles - simple dots, no shadows
            var n = LOWCPU ? (pts.length >> 1) : pts.length;
            for (var i = 0; i < n; i++) {
                var p = pts[i];
                p.x += p.vx; p.y += p.vy; p.life -= p.decay;
                if (p.life <= 0) { var np = mkPart(); p.x = np.x; p.y = np.y; p.vx = np.vx; p.vy = np.vy; p.life = np.life; p.decay = np.decay; p.sz = np.sz; }
                ctx.globalAlpha = p.life * 0.5;
                ctx.fillStyle = "#88ccff";
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.sz, 0, 6.283);
                ctx.fill();
            }

            ctx.globalAlpha = 1;
            ctx.save();
            ctx.translate(cx, cy);

            // Tao rotation
            ctx.save();
            ctx.rotate(rot);

            var pulse = LOWCPU ? 1 : (Math.sin(t * 0.05) * 0.15 + 0.85);

            // Outer glow - simulated with thick semi-transparent stroke
            if (!LOWCPU) {
                ctx.globalAlpha = 0.08 * pulse;
                ctx.strokeStyle = "#88ccff";
                ctx.lineWidth = 8;
                ctx.beginPath(); ctx.arc(0, 0, r + 40, 0, 6.283); ctx.stroke();
            }
            ctx.globalAlpha = 0.25 * pulse;
            ctx.strokeStyle = "#88ccff";
            ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.arc(0, 0, r + 40, 0, 6.283); ctx.stroke();

            // White part
            ctx.globalAlpha = 1;
            ctx.fillStyle = "#f0f0f0";
            ctx.beginPath(); ctx.arc(0, 0, r, 0, 6.283); ctx.fill();

            // Black part
            ctx.fillStyle = "#0a0a0a";
            ctx.beginPath();
            ctx.arc(0, 0, r, -1.5708, 1.5708, false);
            ctx.arc(0, r / 2, r / 2, 1.5708, -1.5708, true);
            ctx.arc(0, -r / 2, r / 2, 1.5708, -1.5708, false);
            ctx.closePath(); ctx.fill();

            // Eyes
            ctx.fillStyle = "#ffffff";
            ctx.beginPath(); ctx.arc(0, -r / 2, r / 7, 0, 6.283); ctx.fill();
            ctx.fillStyle = "#000000";
            ctx.beginPath(); ctx.arc(0, r / 2, r / 7, 0, 6.283); ctx.fill();

            // S-line
            if (!LOWCPU) {
                ctx.globalAlpha = 0.2 * pulse;
                ctx.strokeStyle = "#88ccff";
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(0, 0, r, -1.5708, 1.5708, false);
                ctx.arc(0, r / 2, r / 2, 1.5708, -1.5708, true);
                ctx.arc(0, -r / 2, r / 2, 1.5708, -1.5708, false);
                ctx.stroke();
            }

            // Border
            ctx.globalAlpha = 1;
            ctx.strokeStyle = "#444";
            ctx.lineWidth = 2.5;
            ctx.beginPath(); ctx.arc(0, 0, r, 0, 6.283); ctx.stroke();

            ctx.restore(); // end tao rotation

            // Clock
            if (CLOCK) {
                var now = new Date();
                var sec = now.getSeconds() + now.getMilliseconds() / 1000;
                var min = now.getMinutes() + sec / 60;
                var hr = (now.getHours() % 12) + min / 60;

                ctx.lineCap = "round";
                ctx.globalAlpha = 0.85;

                // Hour
                ctx.strokeStyle = "rgba(255,255,255,0.8)"; ctx.lineWidth = 5;
                ctx.beginPath(); ctx.moveTo(0, 0);
                var ha = (hr / 12) * 6.283 - 1.5708;
                ctx.lineTo(Math.cos(ha) * r * 0.5, Math.sin(ha) * r * 0.5);
                ctx.stroke();

                // Minute
                ctx.strokeStyle = "rgba(136,204,255,0.8)"; ctx.lineWidth = 3;
                ctx.beginPath(); ctx.moveTo(0, 0);
                var ma = (min / 60) * 6.283 - 1.5708;
                ctx.lineTo(Math.cos(ma) * r * 0.8, Math.sin(ma) * r * 0.8);
                ctx.stroke();

                // Second
                ctx.strokeStyle = "rgba(255,170,136,0.8)"; ctx.lineWidth = 1.5;
                ctx.beginPath(); ctx.moveTo(0, 0);
                var sa = (sec / 60) * 6.283 - 1.5708;
                ctx.lineTo(Math.cos(sa) * r * 0.9, Math.sin(sa) * r * 0.9);
                ctx.stroke();

                ctx.globalAlpha = 1;
                ctx.fillStyle = "#fff";
                ctx.beginPath(); ctx.arc(0, 0, 3, 0, 6.283); ctx.fill();
            }

            // Satellites
            if (!LOWCPU) {
                ctx.globalAlpha = 0.45;
                for (var j = 0; j < 4; j++) {
                    var sa2 = t * 0.02 + j * 1.5708;
                    ctx.fillStyle = j % 2 === 0 ? "#88ccff" : "#ffaa88";
                    ctx.beginPath();
                    ctx.arc(Math.cos(sa2) * (r + 25), Math.sin(sa2) * (r + 25), 2.5, 0, 6.283);
                    ctx.fill();
                }
            }

            ctx.restore(); // end translate
        }

        var lastT = 0;
        function loop(ts) {
            if (!running) return;
            if (LOWCPU && ts - lastT < 33) { rafId = requestAnimationFrame(loop); return; }
            lastT = ts;
            rot += SPEED * DIR;
            t++;
            draw();
            rafId = requestAnimationFrame(loop);
        }

        addEventListener("resize", function () { resize(); if (!running) draw(); });

        window.updateSettings = function (count, speed, dir, clock, lowcpu) {
            PARTICLES = count;
            SPEED = speed;
            DIR = dir;
            CLOCK = clock;
            LOWCPU = lowcpu;
            initParts();

            var need = (SPEED !== 0) || (PARTICLES > 0) || CLOCK;
            if (need && !running) { running = true; requestAnimationFrame(loop); }
            else if (!need && running) { running = false; if (rafId) cancelAnimationFrame(rafId); draw(); }
            else draw();
        };

        initParts();
        resize();
        running = true;
        requestAnimationFrame(loop);
    </script>
</body>

</html>